graph TB
    %% Data Sources
    subgraph "Data Sources"
        NYC[("ğŸ—½ NYC Taxi Data<br/>Parquet Files")]
        REF[("ğŸ“‹ Reference Data<br/>Zones, Lookups")]
    end

    %% Ingestion Layer
    subgraph "Ingestion Layer"
        BATCH["ğŸ“¥ Batch Processor<br/>Monthly Data Loading"]
        CURATE["ğŸ”§ Data Curation<br/>Quality Checks"]
    end

    %% Streaming Layer
    subgraph "Streaming Layer"
        PRODUCER["ğŸ“¡ Event Producer<br/>Trip â†’ Events"]
        KAFKA[("âš¡ Kafka<br/>Event Streaming")]
        ASSEMBLER["ğŸ”§ Trip Assembler<br/>Events â†’ Trips"]
        REDIS[("âš¡ Redis<br/>State Management")]
    end

    %% Storage Layer
    subgraph "Storage Layer"
        POSTGRES[("ğŸ—„ï¸ PostgreSQL<br/>Complete Trips")]
    end

    %% Analytics Layer
    subgraph "Analytics Layer"
        AGGREGATOR["ğŸ“Š KPI Aggregator<br/>Zone Hourly Stats"]
        REPORTS["ğŸ“ˆ Reports<br/>Analytics & Insights"]
    end

    %% Infrastructure
    subgraph "Infrastructure"
        DOCKER["ğŸ³ Docker<br/>Containerization"]
        CI["ğŸ”„ GitHub Actions<br/>CI/CD Pipeline"]
        TERRAFORM["ğŸ—ï¸ Terraform<br/>Infrastructure as Code"]
    end

    %% Data Flow
    NYC --> BATCH
    REF --> BATCH
    BATCH --> CURATE
    CURATE --> POSTGRES

    %% Streaming Path
    NYC --> PRODUCER
    PRODUCER --> KAFKA
    KAFKA --> ASSEMBLER
    ASSEMBLER <--> REDIS
    ASSEMBLER --> POSTGRES

    %% Analytics Path
    POSTGRES --> AGGREGATOR
    AGGREGATOR --> REPORTS

    %% Infrastructure connections
    DOCKER -.-> BATCH
    DOCKER -.-> PRODUCER
    DOCKER -.-> ASSEMBLER
    CI -.-> DOCKER
    TERRAFORM -.-> DOCKER

    %% Styling
    classDef dataSource fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000
    classDef processing fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000
    classDef storage fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px,color:#000
    classDef analytics fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000
    classDef infrastructure fill:#fce4ec,stroke:#880e4f,stroke-width:2px,color:#000

    class NYC,REF dataSource
    class BATCH,CURATE,PRODUCER,ASSEMBLER,REDIS processing
    class POSTGRES,KAFKA storage
    class AGGREGATOR,REPORTS analytics
    class DOCKER,CI,TERRAFORM infrastructure
