graph TB
    %% Test Pyramid
    subgraph "Test Pyramid"
        UNIT["ğŸ§ª Unit Tests<br/>Fast, Isolated<br/>~100ms each"]
        INTEGRATION["ğŸ”— Integration Tests<br/>Real Services<br/>~5-10s each"]
        E2E["ğŸŒ End-to-End Tests<br/>Full Pipeline<br/>~30-60s each"]
    end

    %% Test Types
    subgraph "Test Categories"
        STREAM_TESTS["âš¡ Stream Tests<br/>Kafka Integration"]
        BATCH_TESTS["ğŸ“Š Batch Tests<br/>PostgreSQL Integration"]
        CONTRACT_TESTS["ğŸ“‹ Contract Tests<br/>Schema Validation"]
        SMOKE_TESTS["ğŸ’¨ Smoke Tests<br/>CLI Validation"]
        PERFORMANCE["âš¡ Performance Tests<br/>Benchmarks"]
    end

    %% Test Infrastructure
    subgraph "Test Infrastructure"
        TESTCONTAINERS["ğŸ³ Testcontainers<br/>Real Services"]
        POSTGRES_TEST[("ğŸ—„ï¸ PostgreSQL<br/>Test Database")]
        KAFKA_TEST[("âš¡ Kafka<br/>Test Broker")]
        REDIS_TEST[("âš¡ Redis<br/>Test Cache")]
    end

    %% Quality Gates
    subgraph "Quality Gates"
        PRECOMMIT["âœ… pre-commit<br/>Code Quality"]
        LINTING["ğŸ” Linting<br/>flake8, isort"]
        FORMATTING["ğŸ¨ Formatting<br/>Black"]
        TYPE_CHECK["ğŸ“ Type Checking<br/>mypy"]
    end

    %% CI/CD Integration
    subgraph "CI/CD Integration"
        GITHUB_ACTIONS["ğŸ”„ GitHub Actions<br/>Automated Testing"]
        PARALLEL["âš¡ Parallel Execution<br/>7 Test Jobs"]
        MATRIX["ğŸ“Š Matrix Strategy<br/>Efficient Resource Usage"]
    end

    %% Test Flow
    UNIT --> INTEGRATION
    INTEGRATION --> E2E

    STREAM_TESTS --> TESTCONTAINERS
    BATCH_TESTS --> TESTCONTAINERS
    TESTCONTAINERS --> POSTGRES_TEST
    TESTCONTAINERS --> KAFKA_TEST
    TESTCONTAINERS --> REDIS_TEST

    PRECOMMIT --> LINTING
    PRECOMMIT --> FORMATTING
    PRECOMMIT --> TYPE_CHECK

    GITHUB_ACTIONS --> PARALLEL
    PARALLEL --> MATRIX
    MATRIX --> STREAM_TESTS
    MATRIX --> BATCH_TESTS
    MATRIX --> CONTRACT_TESTS
    MATRIX --> SMOKE_TESTS

    %% Styling
    classDef pyramid fill:#e8f5e8,stroke:#2e7d32,stroke-width:3px,color:#000
    classDef categories fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#000
    classDef infrastructure fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,color:#000
    classDef quality fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000
    classDef cicd fill:#e0f2f1,stroke:#00695c,stroke-width:2px,color:#000

    class UNIT,INTEGRATION,E2E pyramid
    class STREAM_TESTS,BATCH_TESTS,CONTRACT_TESTS,SMOKE_TESTS,PERFORMANCE categories
    class TESTCONTAINERS,POSTGRES_TEST,KAFKA_TEST,REDIS_TEST infrastructure
    class PRECOMMIT,LINTING,FORMATTING,TYPE_CHECK quality
    class GITHUB_ACTIONS,PARALLEL,MATRIX cicd
